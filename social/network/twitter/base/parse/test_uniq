#!/usr/bin/env bash

input_file=${1} 		; shift
output_file=${1} 		; shift

if [ "$output_file" == "" ] ; then echo "$0 input_file output_file [mapper=/bin/cat] [reducer=/usr/bin/uniq] [partfields=2] [sortfields=2] [extra_args]" ; exit ; fi

HADOOP_HOME=${HADOOP_HOME-/usr/lib/hadoop}

cmd="${HADOOP_HOME}/bin/hadoop \
     jar         ${HADOOP_HOME}/contrib/streaming/hadoop-*-streaming.jar		
    -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner 			
    -jobconf     num.key.fields.for.partition=\"2\"				
    -jobconf  	 stream.num.map.output.key.fields=\"3\"
    -jobconf     stream.map.output.field.separator=\"'/t'\"
    -jobconf     mapred.text.key.partitioner.options=\"-k1,2\"			
    -mapper  	 \"/bin/cat\"
    -reducer	 \"/usr/bin/uniq\"							
    -input       \"$input_file\"							
    -output  	 \"$output_file\"							
    $@
    "

echo "$cmd"

$cmd
